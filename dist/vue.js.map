{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype; // 数组原型上的方法\r\n\r\n// 不能直接改写数组原有方法 不可靠，因为只有被vue控制的数组才需要改写\r\n\r\nexport let arrayMethods = Object.create(Array.prototype)\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'splice',\r\n    'reverse',\r\n    'sort'\r\n];\r\n\r\n\r\nmethods.forEach(method=>{\r\n    arrayMethods[method] = function(...args) { // 重写数组方法\r\n        console.log('数组变化');\r\n        let result = oldArrayProtoMethods[method].call(this,...args);\r\n\r\n        return result;\r\n    }\r\n});\r\n\r\narrayMethods.push(1,2,3,4);\r\n\r\n","import { arrayMethods } from \"./array\";\r\n\r\nclass Observer {\r\n    constructor(value) { // 需要对这个value属性重新定义\r\n\r\n        // value 可能是对象 可能是数组 分类来处理\r\n       if(Array.isArray(value)){\r\n        // 数组不用defineProperty来进行代理 性能不好\r\n        // push shift reverse sort \r\n        // value.__proto__ = arrayMethods; // 当是数组时 改写方法为自己重写后的方法\r\n        Object.setPrototypeOf(value,arrayMethods); // 循环将属性赋予上去\r\n        this.observeArray(value);\r\n       }else{\r\n        this.walk(value);\r\n       }\r\n    }\r\n    observeArray(value){\r\n        for(let i = 0; i< value.length;i++){\r\n            observe(value[i]);\r\n        }\r\n    }\r\n    walk(data) {\r\n        // 将对象中的所有key 重新用defineProperty 定义成响应式的\r\n        Object.keys(data).forEach(key=>{\r\n            defineReactive(data, key, data[key]);\r\n        })\r\n    }\r\n}\r\n\r\nfunction defineReactive(data,key,value){\r\n    // value 可能使用一个对象\r\n    observe(value); // 对结果递归拦截\r\n    Object.defineProperty(data,key,{\r\n        get(){\r\n            return value;\r\n        },\r\n        set(newValue) {\r\n            if(newValue === value) return;\r\n            observe(newValue); // 如果用户设置的是一个对象，就继续将用户设置的对象变成响应式的\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n    // 只对对象类型进行观测 非对象类型无法观测\r\n\r\n    if(typeof data !== 'object' || data == null){\r\n        return ;\r\n    }\r\n    // 通过类来实现对数据的观测 类可以方便扩展，会产生实例\r\n    return new Observer(data);\r\n} ","import { observe } from \"./observer/index\";\r\n\r\nexport function initState(vm) {\r\n    // 将所有数据都定义在 vm 属性上，并且后续更改 需要触发视图更新\r\n    const opts = vm.$options; // 获取用户属性\r\n    if(opts.props){\r\n        \r\n    }\r\n    if(opts.methods) {\r\n\r\n    }\r\n    if(opts.data) { // 数据的初始化\r\n        initData(vm);\r\n    }\r\n    if(opts.computed){\r\n\r\n    }\r\n    if(opts.watch) {\r\n\r\n    }\r\n    \r\n}\r\n\r\nfunction proxy(vm,source,key) {\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key]\r\n        },\r\n        set(newValue) {\r\n            vm[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    // 数据劫持\r\n    let data = vm.$options.data;\r\n\r\n    // 对data类型进行判断 如果是函数 获取函数返回值作为对象\r\n    data = vm._data =  typeof data === 'function'?data.call(vm):data;\r\n\r\n    // 通过vm._data 获取劫持后的数据，用户就可以拿到_data了\r\n    // 将_data中的数据全部放到vm上\r\n    for(let key in data) {\r\n        proxy(vm,'_data',key); // vm.name => vm._data.name\r\n    }\r\n\r\n    // 观测这个数据\r\n    observe(data);\r\n}","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function (options) {\r\n        const vm = this;\r\n        vm.$options = options; // 实例上有个属性$options 表示的是用户传入的所有属性\r\n        // 初始化状态\r\n        initState(vm);\r\n    }\r\n}\r\n","// Vue2.0中就是一个构造函数 class\r\n\r\nimport { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n    this._init(options); // 当用户new Vue时，就会调用init方法进行vue的初始方法\r\n}\r\n\r\ninitMixin(Vue);\r\nexport default Vue;\r\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","console","log","args","result","call","push","Observer","value","isArray","setPrototypeOf","observeArray","walk","i","length","observe","data","keys","key","defineReactive","defineProperty","get","set","newValue","initState","vm","opts","$options","props","initData","computed","watch","proxy","source","_data","initMixin","Vue","_init","options"],"mappings":"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"}